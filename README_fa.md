![PeDitX Banner](https://raw.githubusercontent.com/peditx/luci-theme-peditx/refs/heads/main/luasrc/brand.png)
# PeDitX's CoreDNS-master: Advanced DNS Proxy and Bypass Manager
## Language Selection:

[**English**](README.md) | [**فارسی**](README_fa.md) | [**中文**](README_zh.md) | [**Русский**](README_ru.md)


[![GitHub license](https://img.shields.io/badge/license-MIT-blue.svg)](https://github.com/peditx/CoreDNS-master/blob/main/LICENSE)
[![GitHub stars](https://img.shields.io/github/stars/peditx/CoreDNS-master.svg?style=social)](https://github.com/peditx/CoreDNS-master/stargazers)
[![GitHub forks](https://img.shields.io/github/forks/peditx/CoreDNS-master.svg?style=social)](https://github.com/peditx/CoreDNS-master/network/members)


## معرفی پروژه

PeDitX's CoreDNS-master یک راه‌حل قدرتمند و انعطاف‌پذیر برای مدیریت ترافیک DNS است که با هدف دور زدن مؤثر محدودیت‌های اینترنتی طراحی شده. این سیستم **CoreDNS** را به عنوان بک‌اند قدرتمند DNS، یک API مبتنی بر **FastAPI** برای کنترل هوشمند، و یک رابط کاربری فرانت‌اند **React.js** را برای تعامل آسان ترکیب می‌کند. این سیستم امکان مسیریابی انتخابی DNS را فراهم می‌آورد، از جمله ویژگی‌های پیشرفته‌ای مانند **فیلترینگ بر اساس Geo-IP** و **یکپارچه‌سازی پراکسی Xray** برای دامنه‌ها یا مناطق جغرافیایی خاص.

هدف اصلی، ارائه یک راه‌حل جامع، با قابلیت مدیریت آسان و مقیاس‌پذیر برای پراکسی DNS است تا به تعداد زیادی از کاربران، کنترل دقیق بر مسیرهای رفع محدودیت DNS را اعطا کند.

-----

## ویژگی‌ها

  * **بک‌اند CoreDNS:** وضوح DNS با کارایی بالا و قابل اعتماد.
  * **API بک‌اند FastAPI:** یک API سریع و مدرن برای مدیریت تمامی تنظیمات DNS.
  * **رابط کاربری فرانت‌اند React.js:** یک رابط وب بصری برای مدیریت آسان دامنه‌ها و قوانین.
  * **رفع محدودیت بر اساس دامنه:** مسیریابی دامنه‌های خاص از طریق سرورهای DNS سفارشی.
  * **مسیریابی بر اساس Geo-IP:** هدایت پرس‌وجوهای DNS بر اساس موقعیت جغرافیایی کاربر با استفاده از MaxMind GeoLite2.
  * **مسیریابی بر اساس Geo-Site:** اعمال قوانین DNS خاص بر روی لیست‌هایی از دامنه‌ها که بر اساس منطقه یا هدف دسته‌بندی شده‌اند.
  * **یکپارچه‌سازی پراکسی Xray:** مسیریابی یکپارچه ترافیک DNS برای دامنه‌ها یا مناطق انتخاب‌شده از طریق یک تونل Xray برای دور زدن پیشرفته محدودیت‌ها، که مستقیماً از رابط کاربری مدیریت می‌شود.
  * **مدیریت خودکار تنظیمات:** API به صورت پویا تنظیمات CoreDNS را ایجاد و سرویس را مجدداً بارگذاری می‌کند.
  * **نصب آسان:** فرآیند نصب و تغییرات ساده‌شده از طریق اسکریپت‌های شل تعاملی.

-----

## معماری

این پروژه از یک معماری مدرن سه لایه بهره می‌برد:

  * **لایه DNS:** CoreDNS به عنوان سرور DNS اصلی عمل می‌کند، و برای رسیدگی به درخواست‌ها و اعمال سیاست‌های مسیریابی بر اساس دستورالعمل‌های API بک‌اند پیکربندی شده است.
  * **لایه API:** یک اپلیکیشن FastAPI پایتون به عنوان لایه کنترل عمل می‌کند. این لایه با یک پایگاه داده PostgreSQL برای ذخیره تنظیمات (دامنه‌ها، قوانین GeoIP، تنظیمات Xray) تعامل دارد و به صورت پویا فایل‌های پیکربندی CoreDNS را به‌روز می‌کند. همچنین، راه‌اندازی مجدد سرویس Xray را نیز مدیریت می‌کند.
  * **لایه نمایش:** یک اپلیکیشن تک‌صفحه‌ای (SPA) React.js، یک رابط وب کاربرپسند را برای مدیران فراهم می‌کند تا با API تعامل داشته باشند و مدیریت قوانین پیچیده مسیریابی را آسان‌تر کند.

-----

## نصب

این پروژه از مجموعه‌ای از اسکریپت‌های نصب و تغییرات متوالی برای راه‌اندازی کامل محیط روی **سیستم‌عامل‌های مبتنی بر Debian/Ubuntu** استفاده می‌کند.

**برای اطمینان از راه‌اندازی بی‌مشکل، اکیداً توصیه می‌شود مراحل نصب را به ترتیب دنبال کنید.**

### پیش‌نیازها

قبل از شروع، مطمئن شوید که موارد زیر را دارید:

  * یک سرور جدید Debian/Ubuntu (VPS توصیه می‌شود).
  * دسترسی روت یا کاربری با مجوز `sudo`.
  * یک اتصال اینترنتی فعال در سرور.
  * **(اختیاری اما برای Geo-IP توصیه می‌شود):** یک [MaxMind GeoLite2 License Key](https://www.maxmind.com/en/geolite2/downloads) برای دانلود پایگاه‌های داده GeoIP.
  * **(اختیاری اما برای Xray توصیه می‌شود):** جزئیات سرور ریموت Xray شما (IP/دامنه، پورت، UUID، پروتکل، شبکه، تنظیمات TLS).

### نصب سریع

برای نصب تمام پیش‌نیازهای لازم و اجرای منوی تعاملی اصلی، دستور زیر را اجرا کنید:

```bash
rm -f setup.sh && wget https://raw.githubusercontent.com/peditx/CoreDNS-master/refs/heads/main/setup.sh && chmod +x setup.sh && sudo bash setup.sh
```

این دستور اقدامات زیر را انجام خواهد داد:

1.  فایل `setup.sh` موجود (در صورت وجود) را حذف می‌کند.
2.  جدیدترین اسکریپت `setup.sh` را از ریپازیتوری گیت‌هاب دانلود می‌کند.
3.  مجوزهای اجرایی را به اسکریپت دانلود شده می‌دهد.
4.  اسکریپت `setup.sh` را با مجوزهای `sudo` اجرا می‌کند.

سپس اسکریپت `setup.sh` اقدامات زیر را انجام می‌دهد:

  * سیستم شما را به‌روزرسانی کرده و ابزارهای ضروری (curl, wget, git, vim, systemctl و غیره) را نصب می‌کند.
  * **Node.js، npm و `create-react-app`** را نصب می‌کند.
  * **Python3، pip و `python3-venv`** را نصب می‌کند.
  * **PostgreSQL** را نصب می‌کند.
  * **Nginx** را نصب می‌کند.
  * **UFW** (فایروال ساده) و **ACL** را نصب می‌کند.
  * در نهایت، اسکریپت `menu.sh` را دانلود و اجرا می‌کند، که یک رابط تعاملی برای نصب و پیکربندی اجزای CoreDNS Bypass Manager فراهم می‌آورد.

### نصب گام به گام (از طریق `menu.sh`)

پس از اتمام کار `setup.sh`، اسکریپت `menu.sh` به صورت خودکار اجرا خواهد شد. دستورالعمل‌های روی صفحه را دنبال کنید و گزینه‌ها را به ترتیب لیست شده در زیر انتخاب کنید تا سیستم خود را به طور کامل راه‌اندازی کنید:

1.  **نصب CoreDNS (install\_coredns.sh):** سرور CoreDNS را راه‌اندازی می‌کند.
2.  **نصب API Backend (install\_api\_backend.sh):** اپلیکیشن FastAPI را مستقر کرده و PostgreSQL را پیکربندی می‌کند.
3.  **نصب Frontend UI (install\_frontend\_ui.sh):** رابط وب React.js را راه‌اندازی کرده و Nginx را برای سرو آن پیکربندی می‌کند.
4.  **اعمال ماد Geo-IP (mod\_geo\_ip.sh):** قابلیت Geo-IP را در API و CoreDNS یکپارچه می‌کند.
5.  **یکپارچه‌سازی Xray (mod\_xray\_integration.sh):** Xray را نصب و پراکسی DNS محلی آن را راه‌اندازی می‌کند، و API را برای کنترل Xray پیکربندی می‌کند.
6.  **به‌روزرسانی رابط کاربری Xray (update\_xray\_ui\_integration.sh):** رابط کاربری فرانت‌اند را برای مدیریت تنظیمات Xray، قوانین GeoIP و لیست‌های GeoSite به صورت مستقیم، به‌روزرسانی می‌کند.

**مهم:** هر اسکریپت در منو بر اساس مرحله قبلی خود ساخته شده است. **از هیچ مرحله‌ای صرف نظر نکنید یا آنها را به ترتیب اشتباه اجرا نکنید،** مگر اینکه به طور کامل وابستگی‌ها را درک کرده باشید.

-----

## استفاده

پس از نصب موفقیت‌آمیز، رابط کاربری CoreDNS Bypass Manager شما از طریق آدرس IP سرور یا دامنه شما بر روی پورت Nginx (پیش‌فرض: ۸۰) قابل دسترسی خواهد بود.

  * **دسترسی به رابط کاربری:** مرورگر وب خود را باز کرده و به `http://YOUR_SERVER_IP` (یا `http://YOUR_SERVER_IP:NGINX_PORT` اگر پورت غیر پیش‌فرض را انتخاب کرده‌اید) بروید.
  * **مستندات API:** مستندات Swagger UI API در `http://YOUR_SERVER_IP:API_PORT/docs` (پورت پیش‌فرض API: ۸۰۰۰) در دسترس خواهد بود.

رابط کاربری امکانات زیر را فراهم می‌کند:

  * اضافه کردن، ویرایش و حذف دامنه‌ها برای رفع محدودیت.
  * پیکربندی قوانین Geo-IP (بر اساس کد کشور) برای مسیریابی یا مسدودسازی خاص.
  * مدیریت لیست‌های Geo-Site با مسیریابی سفارشی.
  * **به‌روزرسانی تنظیمات Xray:** ارائه `config.json` Xray از طریق URL یا چسباندن مستقیم آن.
  * **به‌روزرسانی پایگاه داده GeoIP:** شروع دانلود آخرین پایگاه داده MaxMind GeoLite2 (نیاز به کلید لایسنس دارد).
  * **اعمال تغییرات CoreDNS:** اعمال تمامی تنظیمات مبتنی بر پایگاه داده به CoreDNS و بارگذاری مجدد سرویس آن.

-----

## ملاحظات امنیتی

  * **فایروال:** اطمینان حاصل کنید که UFW به گونه‌ای پیکربندی شده است که فقط پورت‌های ضروری را مجاز کند (۵۳ برای DNS، ۸۰/۴۴۳ برای Nginx، ۸۰۰۰ برای دسترسی به API، ۹۱۵۳ برای Prometheus).
  * **کاربران اختصاصی:** اسکریپت‌های نصب تلاش می‌کنند از کاربران سیستمی اختصاصی (`coredns`، `api_user`) برای افزایش امنیت استفاده کنند. سرویس‌ها را در محیط Production به عنوان روت اجرا نکنید.
  * **پیکربندی Sudoers:** API برای `systemctl reload coredns` و `systemctl restart xray` نیاز به دسترسی `sudo` بدون رمز عبور (`NOPASSWD`) دارد. این مجوزها را تا حد امکان برای محیط خاص خود بررسی و محدودتر کنید.
  * **کلید لایسنس MaxMind:** کلید لایسنس MaxMind خود را محرمانه نگه دارید.
  * **تنظیمات Xray:** فایل `config.json` Xray شما حاوی اطلاعات حساسی (UUID، جزئیات سرور) است. اطمینان حاصل کنید که ایمن است و فقط توسط API قابل دسترسی باشد.
  * **احراز هویت API:** برای محیط‌های Production، **اکیداً توصیه می‌شود** احراز هویت API (مثلاً با استفاده از توکن‌های JWT) را برای جلوگیری از دسترسی غیرمجاز به سیستم مدیریت DNS خود پیاده‌سازی کنید. این در راه‌اندازی پایه برای سادگی گنجانده نشده است، اما برای امنیت حیاتی است.

-----

## عیب‌یابی

  * **بررسی وضعیت سرویس:**
      * `sudo systemctl status coredns`
      * `sudo systemctl status dns_api`
      * `sudo systemctl status xray`
      * `sudo systemctl status nginx`
  * **مشاهده لاگ‌ها:**
      * `sudo journalctl -u coredns --no-pager`
      * `sudo journalctl -u dns_api --no-pager`
      * `sudo journalctl -u xray --no-pager`
      * `sudo journalctl -u nginx --no-pager`
  * **مشکلات مجوز:** بسیاری از مشکلات مربوط به مجوزهای فایل است. اطمینان حاصل کنید که `api_user` دارای دسترسی نوشتن به `/etc/coredns` و `/usr/local/etc/xray` است.
  * **ارتباط API:** از `curl` برای تست مستقیم Endpointsهای API از سرور استفاده کنید تا مشکلات را جداسازی کنید.
  * **کنسول رابط کاربری:** کنسول توسعه‌دهنده مرورگر خود را برای خطاهای جاوااسکریپت یا مشکلات شبکه هنگام استفاده از رابط کاربری بررسی کنید.

-----

## مشارکت

مشارکت‌ها مورد استقبال قرار می‌گیرند\! اگر باگ‌ها، درخواست‌های ویژگی، یا تمایل به بهبود کد دارید، در باز کردن یک Issue یا ارسال یک Pull Request در ریپازیتوری گیت‌هاب تردید نکنید.

-----

## مجوز

این پروژه تحت مجوز MIT منتشر شده است - برای جزئیات بیشتر به فایل [LICENSE](https://www.google.com/search?q=LICENSE) مراجعه کنید.
